{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<!-- Main Content -->
<main class="flex-1 flex flex-col items-center justify-center p-6 relative overflow-hidden">

    <!-- Subtle Pattern -->
    <div
        class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiM5NDkzYjgiIGZpbGwtb3BhY2l0eT0iMC4xIi8+PC9zdmc+')] opacity-50 z-0">
    </div>

    <div class="text-center max-w-2xl mx-auto mb-12 relative z-10">
        <div
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-50 border border-emerald-100 text-emerald-600 text-xs font-bold mb-6 shadow-sm">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
            SYSTEM OPERATIONAL
        </div>
        <h1 class="text-5xl font-bold text-slate-900 mb-6 tracking-tight leading-tight">Automated Traffic Violation
            Detection</h1>
        <p class="text-lg text-slate-500">Upload CCTV footage to instantly detect speeding, red-light running, and
            illegal lane changes using state-of-the-art AI.</p>
    </div>

    <!-- Upload Zone -->
    <div class="w-full max-w-xl bg-white border border-slate-200 rounded-3xl p-16 text-center hover:border-slate-400 hover:shadow-float transition-all cursor-pointer group shadow-card relative z-10"
        id="drop-zone">
        <div
            class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-slate-50 text-slate-400 mb-8 group-hover:bg-slate-900 group-hover:text-white transition-all shadow-inner group-hover:shadow-lg group-hover:scale-110 duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" x2="12" y1="3" y2="15" />
            </svg>
        </div>
        <h3 class="text-2xl font-bold text-slate-900 mb-3">Drop video file here</h3>
        <p class="text-slate-500 mb-8 font-medium">Support for MP4, AVI, MKV (Max 500MB)</p>

        <form id="upload-form" action="{{ url_for('upload.upload_video') }}" method="post"
            enctype="multipart/form-data">
            <input type="file" name="video" id="file-input" class="hidden" accept=".mp4,.avi,.mkv">
            <button type="button" onclick="document.getElementById('file-input').click()"
                class="px-8 py-3.5 bg-slate-900 hover:bg-slate-800 text-white font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl shadow-slate-900/20 translate-y-0 group-hover:-translate-y-1">
                Browse Files
            </button>
        </form>
        <div id="upload-status" class="mt-4 text-sm font-medium text-slate-600 hidden">Uploading... <span
                id="progress">0%</span></div>
    </div>

    <!-- Recent Activity Mini -->
    <div class="mt-16 w-full max-w-md relative z-10">
        <div class="flex items-center justify-between mb-4 px-2">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Recent Activity</p>
        </div>
        <div class="space-y-3">
            <div
                class="flex items-center justify-between p-4 rounded-xl bg-white border border-slate-200 shadow-soft hover:shadow-md transition-all cursor-default">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-slate-900">Processing Video</p>
                        <p class="text-xs text-slate-500">cam_junction_04.mp4</p>
                    </div>
                </div>
                <div class="flex flex-col items-end gap-1">
                    <span class="text-sm font-bold text-slate-900">84%</span>
                    <div class="w-16 h-1 bg-slate-100 rounded-full overflow-hidden">
                        <div class="w-[84%] h-full bg-emerald-500"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

<script>
    const fileInput = document.getElementById('file-input');
    const uploadForm = document.getElementById('upload-form');
    const statusDiv = document.getElementById('upload-status');

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            const formData = new FormData(uploadForm);
            statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = '<span class="text-blue-600">üìπ Uploading and processing video...</span>';

            fetch(uploadForm.action, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        statusDiv.innerHTML = `<span class="text-red-600">‚ùå ${data.error}</span>`;
                    } else {
                        statusDiv.innerHTML = `
                            <span class="text-emerald-600">‚úÖ Processing Complete!</span><br>
                            <span class="text-sm">Frames: ${data.frames_processed || 0} | Violations: ${data.violations_detected || 0}</span><br>
                            <span class="text-xs text-slate-500">Redirecting to violation details...</span>
                        `;

                        // Redirect to violation detail or dashboard
                        setTimeout(() => {
                            window.location.href = data.redirect_url || '/dashboard';
                        }, 2000);
                    }
                })
                .catch(error => {
                    statusDiv.innerHTML = '<span class="text-red-600">‚ùå Upload Failed</span>';
                    console.error(error);
                });
        }
    });
</script>
{% endblock %}